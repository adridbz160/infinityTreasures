---
import "../styles/misProductos.css";

import { parse } from "cookie";
import { Pool } from "pg";

// Conexión a la base de datos
const pool = new Pool({
  connectionString: import.meta.env.DATABASE_URL,
});

// Leer cookies para obtener la sesión
const cookies = parse(Astro.request.headers.get("cookie") || "");
const sessionId = cookies.session;

let usuario = null;
if (sessionId) {
  // Consultar la base de datos para obtener los datos del usuario
  const res = await pool.query("SELECT * FROM usuarios WHERE id = $1", [
    sessionId,
  ]);
  usuario = res.rows[0];
}

if (!usuario) {
  throw Astro.redirect("/acceso"); // Redirigir si no se encuentra el usuario
}
---

<header id="headerProductos">
  <section class="header-izq">
    <h1>Mis Productos</h1>
  </section>
  <a href="#" class="header-der">
    <div class="imgUser">
      <!-- Mostrar la imagen de perfil del usuario -->
      <img
        src={usuario.foto_perfil || "/img/default_profile_pic.webp"}
        alt="Foto de perfil"
      />
    </div>
    <span>{usuario.nombre_usuario}</span>
  </a>
</header>
<main>
  <header>
    <h1>Productos</h1>
    <div>
      <button>Nuevo</button>
      <div>
        <img src="https://via.placeholder.com/32" alt="Avatar de usuario" />
        <span>Usuario</span>
      </div>
    </div>
  </header>

  <section aria-labelledby="filtros">
    <h2 id="filtros" class="visually-hidden">Filtros</h2>
    <form>
      <label for="categoria">Categoría:</label>
      <select id="categoria" name="categoria">
        <option value="">Todas</option>
        <option value="camisetas">Camisetas</option>
        <option value="pantalones">Pantalones</option>
        <option value="zapatos">Zapatos</option>
      </select>

      <label for="buscar">Buscar:</label>
      <input
        type="text"
        id="buscar"
        name="buscar"
        placeholder="Buscar producto"
      />

      <button type="submit">Filtrar</button>
    </form>
  </section>

  <section aria-labelledby="lista-productos">
    <h2 id="lista-productos">Lista de productos</h2>
    <div>
      <article>
        <img src="https://via.placeholder.com/300x200" alt="Producto 1" />
        <div>
          <h3>Producto 1</h3>
          <p>Descripción del producto 1</p>
          <span>$19.99</span>
        </div>
      </article>
      <article>
        <img src="https://via.placeholder.com/300x200" alt="Producto 2" />
        <div>
          <h3>Producto 2</h3>
          <p>Descripción del producto 2</p>
          <span>$29.99</span>
        </div>
      </article>
      <article>
        <img src="https://via.placeholder.com/300x200" alt="Producto 3" />
        <div>
          <h3>Producto 3</h3>
          <p>Descripción del producto 3</p>
          <span>$39.99</span>
        </div>
      </article>
    </div>
  </section>
</main>
