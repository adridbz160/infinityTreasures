---
import "../styles/misProductos.css";

import { parse } from "cookie";
import { Pool } from "pg";

// Conexión a la base de datos
const pool = new Pool({
  connectionString: import.meta.env.DATABASE_URL,
});

// Leer cookies para obtener la sesión
const cookies = parse(Astro.request.headers.get("cookie") || "");
const sessionId = cookies.session;

let usuario = null;
if (sessionId) {
  // Consultar la base de datos para obtener los datos del usuario
  const res = await pool.query("SELECT * FROM usuarios WHERE id = $1", [
    sessionId,
  ]);
  usuario = res.rows[0];
}

if (!usuario) {
  throw Astro.redirect("/acceso"); // Redirigir si no se encuentra el usuario
}
---

<header id="headerProductos">
  <section class="header-izq">
    <h1>Mis Productos</h1>
  </section>
  <a href="#" class="header-der">
    <div class="imgUser">
      <!-- Mostrar la imagen de perfil del usuario -->
      <img
        src={usuario.foto_perfil || "/img/default_profile_pic.webp"}
        alt="Foto de perfil"
      />
    </div>
    <span>{usuario.nombre_usuario}</span>
  </a>
</header>
<main id="container">
  <!-- Filtros y búsqueda -->
  <section class="filters-box" aria-label="Filtros de productos">
    <div class="filters-row">
      <div class="search-container">
        <div class="search-icon">
          <i class="fas fa-search"></i>
        </div>
        <input
          type="search"
          class="search-input"
          placeholder="Buscar productos..."
          aria-label="Buscar productos"
        />
      </div>
      <div class="filters-selects">
        <label>
          <span class="sr-only">Filtrar por categoría</span>
          <select class="select-filter">
            <option>Todas las categorías</option>
            <option>Electrónica</option>
            <option>Ropa</option>
            <option>Hogar</option>
            <option>Deportes</option>
          </select>
        </label>
        <label>
          <span class="sr-only">Ordenar productos</span>
          <select class="select-filter">
            <option>Ordenar por</option>
            <option>Más recientes</option>
            <option>Precio: menor a mayor</option>
            <option>Precio: mayor a menor</option>
            <option>Mejor valorados</option>
          </select>
        </label>
      </div>
    </div>
  </section>

  <!-- Lista de productos -->
  <section class="product-grid" aria-label="Listado de productos">
    <!-- Tarjeta de producto -->
    <article class="product-card">
      <figure class="product-image-container">
        <img
          src="https://images.unsplash.com/photo-1523275335684-37898b6baf30?..."
          alt="Reloj inteligente"
          class="product-image"
        />
        <figcaption class="badge available">Disponible</figcaption>
      </figure>
      <div class="product-details">
        <header class="product-header">
          <div>
            <h3 class="product-title">Reloj Inteligente Pro</h3>
            <p class="product-category">Electrónica</p>
          </div>
          <span class="product-price">$199.99</span>
        </header>
        <p class="product-description">
          Reloj inteligente con monitor de frecuencia cardíaca, GPS integrado y
          resistencia al agua hasta 50 metros.
        </p>
        <footer class="product-footer">
          <div class="product-rating" aria-label="Valoración del producto">
            <i class="fas fa-star"></i>
            <span>4.8</span>
            <span class="separator">•</span>
            <span>24 ventas</span>
          </div>
          <div class="product-actions">
            <button class="edit-btn" aria-label="Editar producto"
              ><i class="fas fa-edit"></i></button
            >
            <button class="delete-btn" aria-label="Eliminar producto"
              ><i class="fas fa-trash"></i></button
            >
          </div>
        </footer>
      </div>
    </article>
    <!-- Repite los demás artículos aquí -->
  </section>

  <!-- Agregar nuevo producto -->
  <section class="add-product-card" aria-label="Agregar nuevo producto">
    <div class="add-product-content">
      <div class="add-product-icon">
        <i class="fas fa-plus"></i>
      </div>
      <h3>Agregar nuevo producto</h3>
      <p>Comienza a vender algo nuevo</p>
    </div>
  </section>

  <!-- Paginación -->
  <footer class="pagination-container" aria-label="Paginación de productos">
    <div class="pagination-info">
      Mostrando <span>1</span> a <span>6</span> de <span>12</span> resultados
    </div>
    <nav class="pagination" aria-label="Páginas">
      <a href="#" class="pagination-btn" aria-label="Página anterior">
        <i class="fas fa-chevron-left"></i>
      </a>
      <a href="#" class="pagination-page current" aria-current="page">1</a>
      <a href="#" class="pagination-page">2</a>
      <a href="#" class="pagination-page">3</a>
      <a href="#" class="pagination-btn" aria-label="Página siguiente">
        <i class="fas fa-chevron-right"></i>
      </a>
    </nav>
  </footer>
</main>
