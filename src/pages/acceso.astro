---
import Layout from "../layouts/Layout.astro";
import "../styles/acceso.css";
import { parse } from "cookie";
import type { APIRoute } from "astro";

// Este bloque es la lógica para redirigir al usuario si ya está logueado
export const GET: APIRoute = async ({ request, redirect }) => {
  const cookies = parse(request.headers.get("cookie") || "");
  const session = cookies.session;

  if (session) {
    return redirect("/perfil"); // Redirige al perfil si ya está logueado
  }

  // Si no está logueado, muestra la página de acceso
  return new Response(null, {
    status: 200,
    headers: {
      "X-Bypass-Access": "true", // Esto es solo para debugging
    },
  });
};
---

<Layout>
  <main>
    <h1>Acceso</h1>
    <section>
      <!-- Formulario de Registro -->
      <section>
        <h2>Registro</h2>
        <form action="/api/register" method="POST">
          <input
            name="nombre_usuario"
            placeholder="Nombre de usuario"
            required
          />
          <input name="nombre" placeholder="Nombre" required />
          <input name="apellido" placeholder="Apellido" required />
          <input name="email" type="email" placeholder="Email" required />
          <input
            name="contraseña"
            type="password"
            placeholder="Contraseña"
            required
          />
          <button type="submit">Registrarse</button>
        </form>
      </section>

      <!-- Formulario de Login -->
      <section>
        <h2>Login</h2>
        <form action="/api/login" method="POST">
          <input name="email" type="email" placeholder="Email" required />
          <input
            name="contraseña"
            type="password"
            placeholder="Contraseña"
            required
          />
          <button type="submit">Iniciar sesión</button>
        </form>
      </section>
    </section>
  </main>
</Layout>
